<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TESTE COMPLETO - MacDavis</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #1a1a1a; color: white; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { background: #2a2a2a; padding: 20px; margin: 20px 0; border-radius: 10px; }
        .btn { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; text-decoration: none; display: inline-block; }
        .btn:hover { background: #45a049; }
        .btn-danger { background: #f44336; }
        .btn-warning { background: #ff9800; }
        .status { padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { background: rgba(76, 175, 80, 0.2); border: 1px solid #4CAF50; }
        .error { background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; }
        .info { background: rgba(33, 150, 243, 0.2); border: 1px solid #2196F3; }
        #testResults { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ TESTE COMPLETO DO SISTEMA MacDavis</h1>
        
        <div class="section">
            <h2>ğŸ“‹ Status Atual</h2>
            <div id="serverStatus" class="status info">Verificando servidor...</div>
            <div id="apiStatus" class="status info">Verificando API...</div>
        </div>
        
        <div class="section">
            <h2>ğŸš€ NavegaÃ§Ã£o RÃ¡pida</h2>
            <a href="index.html" class="btn">ğŸ  Home</a>
            <a href="login.html" class="btn">ğŸ” Login</a>
            <a href="catalog.html" class="btn">ğŸ“‹ CatÃ¡logo</a>
            <a href="admin.html" class="btn btn-warning">âš™ï¸ Admin</a>
            <a href="agendamento.html" class="btn">ğŸ“… Agendamento</a>
        </div>
        
        <div class="section">
            <h2>ğŸ§ª Testes AutomÃ¡ticos</h2>
            <button onclick="testarTudo()" class="btn">â–¶ï¸ Executar Todos os Testes</button>
            <button onclick="limparTestes()" class="btn btn-danger">ğŸ—‘ï¸ Limpar Resultados</button>
            
            <div id="testResults"></div>
        </div>
        
        <div class="section">
            <h2>âš¡ AÃ§Ãµes RÃ¡pidas</h2>
            <button onclick="loginRapido()" class="btn">âš¡ Login Admin RÃ¡pido</button>
            <button onclick="loginCliente()" class="btn">ğŸ‘¤ Login Cliente</button>
            <button onclick="verificarMotos()" class="btn">ğŸï¸ Verificar Motocicletas</button>
            <button onclick="testarAPI()" class="btn">ğŸ”Œ Testar API</button>
        </div>
        
        <div class="section">
            <h2>ğŸ“Š Logs do Sistema</h2>
            <div id="systemLogs" style="background: #000; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;">
                <div style="color: #4CAF50;">Sistema inicializado...</div>
            </div>
        </div>
    </div>

    <script>
        let logCounter = 0;
        
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('systemLogs');
            const colors = {
                success: '#4CAF50',
                error: '#f44336',
                warning: '#ff9800',
                info: '#2196F3'
            };
            
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = colors[type] || colors.info;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
            
            console.log(`[${timestamp}] ${message}`);
        }
        
        async function verificarStatus() {
            log('ğŸ” Verificando status do servidor...', 'info');
            
            try {
                const response = await fetch('/api/motorcycles');
                if (response.ok) {
                    document.getElementById('serverStatus').className = 'status success';
                    document.getElementById('serverStatus').textContent = 'âœ… Servidor: Online';
                    document.getElementById('apiStatus').className = 'status success';
                    document.getElementById('apiStatus').textContent = 'âœ… API: Funcionando';
                    log('âœ… Servidor e API funcionando normalmente', 'success');
                } else {
                    throw new Error('API retornou erro');
                }
            } catch (error) {
                document.getElementById('serverStatus').className = 'status error';
                document.getElementById('serverStatus').textContent = 'âŒ Servidor: Offline';
                document.getElementById('apiStatus').className = 'status error';
                document.getElementById('apiStatus').textContent = 'âŒ API: Com problemas';
                log('âŒ Erro no servidor/API: ' + error.message, 'error');
            }
        }
        
        async function testarTudo() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="status info">ğŸ§ª Executando testes...</div>';
            
            log('ğŸ§ª Iniciando bateria de testes completos...', 'info');
            
            const testes = [
                { nome: 'API Motorcycles', func: testarAPIMotos },
                { nome: 'LocalStorage', func: testarLocalStorage },
                { nome: 'Login System', func: testarLogin },
                { nome: 'Navigation', func: testarNavegacao }
            ];
            
            let resultados = [];
            
            for (const teste of testes) {
                try {
                    log(`ğŸ” Testando: ${teste.nome}...`, 'info');
                    const resultado = await teste.func();
                    resultados.push({ nome: teste.nome, status: 'success', msg: resultado });
                    log(`âœ… ${teste.nome}: ${resultado}`, 'success');
                } catch (error) {
                    resultados.push({ nome: teste.nome, status: 'error', msg: error.message });
                    log(`âŒ ${teste.nome}: ${error.message}`, 'error');
                }
            }
            
            // Exibir resultados
            resultsDiv.innerHTML = resultados.map(r => 
                `<div class="status ${r.status === 'success' ? 'success' : 'error'}">
                    ${r.status === 'success' ? 'âœ…' : 'âŒ'} ${r.nome}: ${r.msg}
                </div>`
            ).join('');
            
            log('ğŸ Testes concluÃ­dos!', 'info');
        }
        
        async function testarAPIMotos() {
            const response = await fetch('/api/motorcycles');
            if (!response.ok) throw new Error('API nÃ£o respondeu');
            const data = await response.json();
            if (!Array.isArray(data)) throw new Error('Formato invÃ¡lido');
            return `${data.length} motocicletas carregadas`;
        }
        
        function testarLocalStorage() {
            try {
                localStorage.setItem('test', 'ok');
                const value = localStorage.getItem('test');
                localStorage.removeItem('test');
                if (value !== 'ok') throw new Error('Falha na leitura');
                return 'Funcionando normalmente';
            } catch (error) {
                throw new Error('LocalStorage indisponÃ­vel');
            }
        }
        
        function testarLogin() {
            const userData = localStorage.getItem('userData');
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    return `UsuÃ¡rio logado: ${user.nome || user.email || 'Desconhecido'}`;
                } catch {
                    return 'Dados de login corrompidos';
                }
            } else {
                return 'Nenhum usuÃ¡rio logado';
            }
        }
        
        async function testarNavegacao() {
            const paginas = ['index.html', 'catalog.html', 'admin.html'];
            let sucessos = 0;
            
            for (const pagina of paginas) {
                try {
                    const response = await fetch(pagina, { method: 'HEAD' });
                    if (response.ok) sucessos++;
                } catch (error) {
                    // PÃ¡gina nÃ£o encontrada
                }
            }
            
            return `${sucessos}/${paginas.length} pÃ¡ginas acessÃ­veis`;
        }
        
        function loginRapido() {
            log('âš¡ Executando login admin rÃ¡pido...', 'info');
            localStorage.setItem('userData', JSON.stringify({
                nome: 'Admin',
                email: 'admin@macdavis.com',
                tipo: 'admin'
            }));
            log('âœ… Login admin realizado!', 'success');
            setTimeout(() => window.location.href = 'admin.html', 1000);
        }
        
        function loginCliente() {
            log('ğŸ‘¤ Executando login cliente...', 'info');
            localStorage.setItem('userData', JSON.stringify({
                nome: 'Cliente Teste',
                email: 'cliente@test.com',
                tipo: 'cliente'
            }));
            log('âœ… Login cliente realizado!', 'success');
            setTimeout(() => window.location.href = 'catalog.html', 1000);
        }
        
        async function verificarMotos() {
            log('ğŸï¸ Verificando motocicletas...', 'info');
            try {
                const response = await fetch('/api/motorcycles');
                const motos = await response.json();
                log(`ğŸ“Š Encontradas ${motos.length} motocicletas no sistema`, 'success');
                
                if (motos.length > 0) {
                    const primeiraMoto = motos[0];
                    log(`ğŸ” Primeira moto: ${primeiraMoto.name} - ${primeiraMoto.year}`, 'info');
                }
            } catch (error) {
                log('âŒ Erro ao verificar motocicletas: ' + error.message, 'error');
            }
        }
        
        async function testarAPI() {
            log('ğŸ”Œ Testando todos os endpoints da API...', 'info');
            
            const endpoints = [
                '/api/motorcycles',
                '/api/motorcycles-data'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    if (response.ok) {
                        log(`âœ… ${endpoint}: OK (${response.status})`, 'success');
                    } else {
                        log(`âš ï¸ ${endpoint}: ${response.status}`, 'warning');
                    }
                } catch (error) {
                    log(`âŒ ${endpoint}: ${error.message}`, 'error');
                }
            }
        }
        
        function limparTestes() {
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('systemLogs').innerHTML = '<div style="color: #4CAF50;">Logs limpos...</div>';
            log('ğŸ§¹ Logs e testes limpos', 'info');
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ Sistema de testes carregado!', 'success');
            verificarStatus();
        });
    </script>
</body>
</html>